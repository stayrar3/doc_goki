"use strict";(self.webpackChunkdocusaurus_site=self.webpackChunkdocusaurus_site||[]).push([[7038],{2998:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"smart-wallet-program","title":"Smart Wallet Program","description":"Welcome back, Goki explorers! In our previous chapters, we\'ve explored the Goki SDK as your toolkit and the SmartWalletWrapper as your remote control for Goki Smart Wallets. We also learned about the crucial rules of Owners & Threshold and the added safety of Timelock.","source":"@site/docs/smart-wallet-program.md","sourceDirName":".","slug":"/smart-wallet-program","permalink":"/doc_goki/docs/smart-wallet-program","draft":false,"unlisted":false,"editUrl":"https://github.com/stayrar3/doc_goki/tree/main/docs/smart-wallet-program.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Goki SDK","permalink":"/doc_goki/docs/goki-sdk"},"next":{"title":"Transaction State Account","permalink":"/doc_goki/docs/transaction-state-account"}}');var a=r(4848),o=r(8453);const s={sidebar_position:6},i="Smart Wallet Program",l={},c=[{value:"The Brain of the Goki System",id:"the-brain-of-the-goki-system",level:2},{value:"Key Concepts: What is a Program on Solana?",id:"key-concepts-what-is-a-program-on-solana",level:2},{value:"The Program&#39;s Role in Goki",id:"the-programs-role-in-goki",level:3},{value:"How the Smart Wallet Program Works with Your Commands",id:"how-the-smart-wallet-program-works-with-your-commands",level:2},{value:"1. Creating a Smart Wallet",id:"1-creating-a-smart-wallet",level:3},{value:"2. Proposing a Transaction",id:"2-proposing-a-transaction",level:3},{value:"3. Approving a Transaction",id:"3-approving-a-transaction",level:3},{value:"4. Executing a Transaction",id:"4-executing-a-transaction",level:3},{value:"Under the Hood: The Program in Action",id:"under-the-hood-the-program-in-action",level:2},{value:"Conclusion",id:"conclusion",level:2}];function h(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"smart-wallet-program",children:"Smart Wallet Program"})}),"\n",(0,a.jsxs)(t.p,{children:["Welcome back, Goki explorers! In our previous chapters, we've explored the ",(0,a.jsx)(t.a,{href:"goki-sdk",children:"Goki SDK"})," as your toolkit and the ",(0,a.jsx)(t.a,{href:"smart-wallet-wrapper",children:"SmartWalletWrapper"})," as your remote control for Goki Smart Wallets. We also learned about the crucial rules of ",(0,a.jsx)(t.a,{href:"owners-threshold",children:"Owners & Threshold"})," and the added safety of ",(0,a.jsx)(t.a,{href:"timelock",children:"Timelock"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["But all these amazing features, rules, and controls don't just happen by magic. They are enforced by a powerful piece of code that lives permanently on the Solana blockchain: the ",(0,a.jsx)(t.strong,{children:"Smart Wallet Program"}),"."]}),"\n",(0,a.jsx)(t.h2,{id:"the-brain-of-the-goki-system",children:"The Brain of the Goki System"}),"\n",(0,a.jsxs)(t.p,{children:["Imagine your Smart Wallet is a high-tech vault for your digital assets. The ",(0,a.jsx)(t.a,{href:"smart-wallet-wrapper",children:"SmartWalletWrapper"})," is the keypad and screen on the vault door, and the ",(0,a.jsx)(t.a,{href:"goki-sdk",children:"Goki SDK"})," is the engineering manual for the keypad. But the ",(0,a.jsx)(t.strong,{children:"Smart Wallet Program"})," is the actual ",(0,a.jsx)(t.em,{children:"computer brain"})," inside the vault that processes every command, checks all the rules, and ensures everything is secure."]}),"\n",(0,a.jsxs)(t.p,{children:["This program is the ",(0,a.jsx)(t.strong,{children:"core smart contract"})," residing directly on the Solana blockchain. It defines the complete logic and rules for how a Goki Smart Wallet operates. When you use the ",(0,a.jsx)(t.a,{href:"goki-sdk",children:"Goki SDK"})," or ",(0,a.jsx)(t.a,{href:"smart-wallet-wrapper",children:"SmartWalletWrapper"})," to propose, approve, or execute a transaction, you're ultimately sending instructions to this Smart Wallet Program."]}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"What problem does it solve?"})," It provides a decentralized, transparent, and unchangeable set of rules for managing shared digital assets. Because it lives on the blockchain, everyone can see its code, and once deployed, its rules cannot be changed without another multi-signature process, providing maximum security and trust."]}),"\n",(0,a.jsx)(t.h2,{id:"key-concepts-what-is-a-program-on-solana",children:"Key Concepts: What is a Program on Solana?"}),"\n",(0,a.jsx)(t.p,{children:'Before diving deeper, let\'s quickly clarify what a "program" means in the context of Solana:'}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Like an App on a Smartphone"}),': Think of a program on Solana as an application or software that runs directly on the blockchain. Just as an app has specific functions (like "send message" or "take photo"), a Solana program has specific instructions it can execute (like "create a Smart Wallet" or "execute a transaction").']}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Written in Rust"}),": Most Solana programs, including Goki's Smart Wallet Program, are written in a programming language called Rust."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Immutable and Public"}),": Once a program is deployed to the Solana blockchain, its code is generally unchangeable and publicly visible. This transparency is a key security feature, as anyone can verify its logic."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Manages Accounts"}),': Programs interact with "accounts" on the blockchain. Accounts are like files or storage locations where data is kept. The Smart Wallet Program manages two main types of accounts:',"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["The ",(0,a.jsx)(t.code,{children:"SmartWallet"})," account: Stores the wallet's main configuration (like ",(0,a.jsx)(t.a,{href:"owners-threshold",children:"Owners & Threshold"})," and ",(0,a.jsx)(t.a,{href:"timelock",children:"Timelock"})," settings)."]}),"\n",(0,a.jsxs)(t.li,{children:["The ",(0,a.jsx)(t.a,{href:"transaction-state-account",children:"Transaction State Account"}),": Stores the details of a specific proposed transaction, including its approvals."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(t.h3,{id:"the-programs-role-in-goki",children:"The Program's Role in Goki"}),"\n",(0,a.jsx)(t.p,{children:"The Smart Wallet Program is responsible for:"}),"\n",(0,a.jsxs)(t.table,{children:[(0,a.jsx)(t.thead,{children:(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.th,{style:{textAlign:"left"},children:"Feature"}),(0,a.jsx)(t.th,{style:{textAlign:"left"},children:"Program's Role"})]})}),(0,a.jsxs)(t.tbody,{children:[(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{style:{textAlign:"left"},children:(0,a.jsx)(t.strong,{children:"Wallet Creation"})}),(0,a.jsxs)(t.td,{style:{textAlign:"left"},children:["It creates the ",(0,a.jsx)(t.code,{children:"SmartWallet"})," account, storing the initial ",(0,a.jsx)(t.a,{href:"owners-threshold",children:"Owners & Threshold"})," list, and the ",(0,a.jsx)(t.a,{href:"timelock",children:"Timelock"})," ",(0,a.jsx)(t.code,{children:"minimum_delay"}),"."]})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{style:{textAlign:"left"},children:(0,a.jsx)(t.strong,{children:"Transaction Proposal"})}),(0,a.jsxs)(t.td,{style:{textAlign:"left"},children:["It creates a ",(0,a.jsx)(t.a,{href:"transaction-state-account",children:"Transaction State Account"})," for each proposed action, recording the proposed instructions and the ",(0,a.jsx)(t.code,{children:"eta"})," (",(0,a.jsx)(t.a,{href:"timelock",children:"Timelock"}),")."]})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{style:{textAlign:"left"},children:(0,a.jsx)(t.strong,{children:"Approval Enforcement"})}),(0,a.jsxs)(t.td,{style:{textAlign:"left"},children:["When an ",(0,a.jsx)(t.code,{children:"owner"})," approves, it checks if the owner is valid and updates the ",(0,a.jsx)(t.code,{children:"signers"})," list within the ",(0,a.jsx)(t.a,{href:"transaction-state-account",children:"Transaction State Account"}),"."]})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{style:{textAlign:"left"},children:(0,a.jsx)(t.strong,{children:"Threshold Check"})}),(0,a.jsxs)(t.td,{style:{textAlign:"left"},children:["Before execution, it verifies that the ",(0,a.jsx)(t.code,{children:"num_signers"})," on a transaction meets or exceeds the ",(0,a.jsx)(t.code,{children:"threshold"})," set in the ",(0,a.jsx)(t.code,{children:"SmartWallet"})," account."]})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{style:{textAlign:"left"},children:(0,a.jsx)(t.strong,{children:"Timelock Enforcement"})}),(0,a.jsxs)(t.td,{style:{textAlign:"left"},children:["Before execution, it checks if the current time has passed the ",(0,a.jsx)(t.code,{children:"eta"})," set for the transaction. If not, it prevents execution."]})]}),(0,a.jsxs)(t.tr,{children:[(0,a.jsx)(t.td,{style:{textAlign:"left"},children:(0,a.jsx)(t.strong,{children:"Instruction Execution"})}),(0,a.jsxs)(t.td,{style:{textAlign:"left"},children:["Once all conditions (threshold, timelock) are met, it directly executes the instructions stored within the ",(0,a.jsx)(t.a,{href:"transaction-state-account",children:"Transaction State Account"})," on behalf of the Smart Wallet."]})]})]})]}),"\n",(0,a.jsx)(t.h2,{id:"how-the-smart-wallet-program-works-with-your-commands",children:"How the Smart Wallet Program Works with Your Commands"}),"\n",(0,a.jsxs)(t.p,{children:["As a developer using Goki, you don't directly write Rust code to interact with the Smart Wallet Program. Instead, you use the convenient functions provided by the ",(0,a.jsx)(t.a,{href:"goki-sdk",children:"Goki SDK"})," and the ",(0,a.jsx)(t.a,{href:"smart-wallet-wrapper",children:"SmartWalletWrapper"}),'. These tools then construct the proper messages (called "instructions") and send them to the Smart Wallet Program on the Solana blockchain.']}),"\n",(0,a.jsx)(t.p,{children:"Let's revisit our example of creating a Smart Wallet and executing a transaction, but this time, focusing on the Smart Wallet Program's perspective:"}),"\n",(0,a.jsx)(t.h3,{id:"1-creating-a-smart-wallet",children:"1. Creating a Smart Wallet"}),"\n",(0,a.jsxs)(t.p,{children:["When you call ",(0,a.jsx)(t.code,{children:"sdk.newSmartWallet"}),", the ",(0,a.jsx)(t.a,{href:"goki-sdk",children:"Goki SDK"})," sends an instruction to the Smart Wallet Program."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:'// From Chapter 4: Goki SDK\n// ...\nconst { smartWalletWrapper, tx } = await sdk.newSmartWallet({\n  numOwners: owners.length,\n  owners,\n  threshold,\n  delay: delaySeconds, // The program will store this\n});\nawait tx.confirm();\nconsole.log("New Smart Wallet created by SDK:", smartWalletWrapper.key.toBase58());\n'})}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.em,{children:"Program's Action"}),": The Smart Wallet Program receives this instruction. It then creates a new ",(0,a.jsx)(t.code,{children:"SmartWallet"})," account on the blockchain, storing the ",(0,a.jsx)(t.code,{children:"owners"})," list, the ",(0,a.jsx)(t.code,{children:"threshold"}),", and the ",(0,a.jsx)(t.code,{children:"delay"})," (minimum timelock) inside this account. This defines the fundamental security rules for your new Smart Wallet."]}),"\n",(0,a.jsx)(t.h3,{id:"2-proposing-a-transaction",children:"2. Proposing a Transaction"}),"\n",(0,a.jsxs)(t.p,{children:["When you call ",(0,a.jsx)(t.code,{children:"smartWalletWrapper.newTransaction"}),", the ",(0,a.jsx)(t.a,{href:"smart-wallet-wrapper",children:"SmartWalletWrapper"})," sends another instruction to the Smart Wallet Program."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:'// From Chapter 1: SmartWalletWrapper\n// ...\nconst { transactionKey, tx: proposeTx } =\n  await smartWalletWrapper.newTransaction({\n    proposer: ownerA.publicKey,\n    instructions: [transferInstruction],\n    eta, // The program will store this\n  });\nproposeTx.signers.push(ownerA);\nawait proposeTx.confirm();\nconsole.log("Transaction proposed:", transactionKey.toBase58());\n'})}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.em,{children:"Program's Action"}),": The Smart Wallet Program receives the proposal. It creates a new ",(0,a.jsx)(t.a,{href:"transaction-state-account",children:"Transaction State Account"})," to hold the details of this pending transaction. It records the proposed ",(0,a.jsx)(t.code,{children:"instructions"}),", the ",(0,a.jsx)(t.code,{children:"proposer"}),", and the ",(0,a.jsx)(t.code,{children:"eta"})," (",(0,a.jsx)(t.a,{href:"timelock",children:"Timelock"}),") for this specific transaction. It also marks ",(0,a.jsx)(t.code,{children:"ownerA"})," as having approved it."]}),"\n",(0,a.jsx)(t.h3,{id:"3-approving-a-transaction",children:"3. Approving a Transaction"}),"\n",(0,a.jsxs)(t.p,{children:["When ",(0,a.jsx)(t.code,{children:"smartWalletWrapper.approveTransaction"})," is called by another owner:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:'// From Chapter 1: SmartWalletWrapper\n// ...\nawait smartWalletWrapper\n  .approveTransaction(transactionKey, ownerB.publicKey)\n  .addSigners(ownerB)\n  .confirm();\nconsole.log("Transaction approved by Owner B.");\n'})}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.em,{children:"Program's Action"}),": The Smart Wallet Program checks if ",(0,a.jsx)(t.code,{children:"ownerB"})," is indeed one of the authorized ",(0,a.jsx)(t.a,{href:"owners-threshold",children:"Owners"})," of this Smart Wallet. If yes, it updates the ",(0,a.jsx)(t.code,{children:"signers"})," list within the ",(0,a.jsx)(t.a,{href:"transaction-state-account",children:"Transaction State Account"})," to reflect ",(0,a.jsx)(t.code,{children:"ownerB"}),"'s approval. It now checks if the number of ",(0,a.jsx)(t.code,{children:"signers"})," meets the ",(0,a.jsx)(t.code,{children:"threshold"})," for the Smart Wallet."]}),"\n",(0,a.jsx)(t.h3,{id:"4-executing-a-transaction",children:"4. Executing a Transaction"}),"\n",(0,a.jsxs)(t.p,{children:["When ",(0,a.jsx)(t.code,{children:"smartWalletWrapper.executeTransaction"})," is called:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-typescript",children:'// From Chapter 1: SmartWalletWrapper\n// ...\nawait smartWalletWrapper\n  .executeTransaction({\n    transactionKey,\n    owner: ownerC.publicKey,\n  })\n  .addSigners(ownerC)\n  .confirm();\nconsole.log("Transaction executed successfully!");\n'})}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.em,{children:"Program's Action"}),": This is where the Smart Wallet Program performs its most critical checks:"]}),"\n",(0,a.jsxs)(t.ol,{children:["\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Threshold Check"}),": It first checks the ",(0,a.jsx)(t.a,{href:"transaction-state-account",children:"Transaction State Account"})," to see if ",(0,a.jsx)(t.code,{children:"num_signers"})," (total approvals) is greater than or equal to the ",(0,a.jsx)(t.code,{children:"threshold"})," stored in the ",(0,a.jsx)(t.code,{children:"SmartWallet"})," account. If not, it stops."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Timelock Check"}),": It checks if the current time on the blockchain has passed the ",(0,a.jsx)(t.code,{children:"eta"})," stored in the ",(0,a.jsx)(t.a,{href:"transaction-state-account",children:"Transaction State Account"}),". If the ",(0,a.jsx)(t.code,{children:"eta"})," is in the future, it stops."]}),"\n",(0,a.jsxs)(t.li,{children:[(0,a.jsx)(t.strong,{children:"Execution"}),": If both checks pass, the Smart Wallet Program then takes the ",(0,a.jsx)(t.code,{children:"instructions"})," from the ",(0,a.jsx)(t.a,{href:"transaction-state-account",children:"Transaction State Account"}),' and executes them directly on the Solana blockchain. This is when the SOL is actually sent, or other actions occur. It then marks the transaction as "executed" to prevent it from being run again.']}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"under-the-hood-the-program-in-action",children:"Under the Hood: The Program in Action"}),"\n",(0,a.jsxs)(t.p,{children:["The Smart Wallet Program (",(0,a.jsx)(t.code,{children:"programs/smart-wallet/src/lib.rs"}),") is the central piece of logic that makes Goki work. All the high-level commands from the ",(0,a.jsx)(t.a,{href:"goki-sdk",children:"Goki SDK"})," translate into specific ",(0,a.jsx)(t.em,{children:"instructions"})," that the program processes."]}),"\n",(0,a.jsx)(t.p,{children:"Here's a simplified view of how your commands flow to the Smart Wallet Program:"}),"\n",(0,a.jsx)(t.mermaid,{value:"sequenceDiagram\n    participant YourApp\n    participant GokiSDK\n    participant SolanaNetwork\n    participant SmartWalletProgram\n    participant SmartWalletAccount\n    participant TransactionStateAccount\n\n    YourApp->>GokiSDK: 1. Call high-level function<br>(e.g., newSmartWallet)\n    GokiSDK->>SolanaNetwork: 2. Send transaction with instruction<br>(e.g., create_smart_wallet)\n    SolanaNetwork->>SmartWalletProgram: 3. Invoke instruction handler\n    SmartWalletProgram->>SmartWalletAccount: 4. Create/Update wallet data<br>(e.g., owners, threshold)\n    SmartWalletAccount--\x3e>SmartWalletProgram: 5. Data stored\n    SmartWalletProgram--\x3e>SolanaNetwork: 6. Acknowledge completion\n    SolanaNetwork--\x3e>GokiSDK: 7. Confirm transaction\n    GokiSDK--\x3e>YourApp: 8. Return result (e.g., SmartWalletWrapper)\n\n    YourApp->>GokiSDK: 9. Call another function<br>(e.g., approveTransaction)\n    GokiSDK->>SolanaNetwork: 10. Send transaction with instruction<br>(e.g., approve)\n    SolanaNetwork->>SmartWalletProgram: 11. Invoke instruction handler\n    SmartWalletProgram->>TransactionStateAccount: 12. Update approvals\n    TransactionStateAccount--\x3e>SmartWalletProgram: 13. Data updated\n    SmartWalletProgram--\x3e>SolanaNetwork: 14. Acknowledge completion\n    SolanaNetwork--\x3e>GokiSDK: 15. Confirm transaction\n    GokiSDK--\x3e>YourApp: 16. Confirmation"}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.em,{children:"Explanation"}),": Each action you take through the ",(0,a.jsx)(t.a,{href:"goki-sdk",children:"Goki SDK"})," eventually gets turned into a specific instruction for the ",(0,a.jsx)(t.code,{children:"SmartWalletProgram"}),". The program then reads or writes data to the relevant accounts (",(0,a.jsx)(t.code,{children:"SmartWalletAccount"})," or ",(0,a.jsx)(t.a,{href:"transaction-state-account",children:"Transaction State Account"}),") on the blockchain, enforcing all the rules we've discussed."]}),"\n",(0,a.jsx)(t.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.strong,{children:"Smart Wallet Program"})," is the secure, rule-enforcing engine that powers every Goki Smart Wallet. It's the central smart contract on the Solana blockchain that guarantees the multi-signature and timelock rules are always followed. While you interact with it through the user-friendly ",(0,a.jsx)(t.a,{href:"goki-sdk",children:"Goki SDK"})," and ",(0,a.jsx)(t.a,{href:"smart-wallet-wrapper",children:"SmartWalletWrapper"}),', understanding its role as the on-chain "brain" is key to appreciating the robust security Goki offers.']}),"\n",(0,a.jsxs)(t.p,{children:["In the next chapter, we'll delve deeper into the ",(0,a.jsx)(t.a,{href:"transaction-state-account",children:"Transaction State Account"}),", the specific place on the blockchain where the Smart Wallet Program stores all the information about your proposed and ongoing multi-signature transactions."]})]})}function d(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},8453:(e,t,r)=>{r.d(t,{R:()=>s,x:()=>i});var n=r(6540);const a={},o=n.createContext(a);function s(e){const t=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);